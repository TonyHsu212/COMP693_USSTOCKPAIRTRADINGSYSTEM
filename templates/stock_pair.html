{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
    h2, p {
        font-family: Arial, sans-serif;
        font-size: 16px;
        font-weight: normal;
    }
</style>



<div class="d-flex gap-3 vh-100">
   <!-- Sidebar -->
    <nav class="sidebar custom-sidebar bg-light vh-1200 p-1 " >
        <div class="sidebar-header mb-4">
            <h5>Dashboard </h5>
<!--            <p>Welcome to the dashboard!</p>-->
<!--            <h5>US Stock Pair Trading System</h5>-->
        </div>
        <form class="mb-3">
            <input type="search" class="form-control" placeholder="Search...">
        </form>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link text-dark" href="{{ url_for('pairanalyze.analyze_pair_page') }}" >
                    <i class="bi bi-cash-coin me-2" ></i> Stock Pairs Analysis
                </a>
            </li>

<!--            <li class="nav-item">-->
<!--                <a class="nav-link text-dark" href="/grid_strategy" ><i class="bi bi-cash-coin me-2"></i>Explore Strategies</a>-->
<!--            </li>-->

            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-dark" href="#" id="explorestrategiesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-cash-coin me-2"></i> Explore Strategies
                </a>
                <ul class="dropdown-menu" id="explorestrategiesMenu" aria-labelledby="explorestrategiesDropdown">
                    <li><a class="dropdown-item" href="#">minimum distance strategy</a></li>
                    <li><a class="dropdown-item" href="/grid_strategy">grid strategy</a></li>
                </ul>
            </li>

            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-dark" href="#" id="backteststrategiesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-cash-coin me-2"></i> Backtest Strategies
                </a>
                <ul class="dropdown-menu" id="backteststrategiesMenu" aria-labelledby="backteststrategiesDropdown">
                    <li><a class="dropdown-item" href="{{url_for('strategy.strategy1')}}">minimum distance strategy</a></li>
                    <li><a class="dropdown-item" href="#">grid strategy</a></li>
<!--                    <li><hr class="dropdown-divider"></li>-->
<!--&lt;!&ndash;                    <li><a class="dropdown-item" href="/yet_another_strategy">Yet Another Strategy</a></li>&ndash;&gt;-->
<!--                    <li>-->
<!--                        <button id="addfileButton" class="dropdown-item text-primary">Add More Strategy</button>-->
<!--                        <input type="file" id="addfileInput" style="display: none;">-->
                    </li>
                </ul>
            </li>

            <script>
                let i = 0; // Initialize counter

                document.getElementById("fileButton").addEventListener("click", function () {
                    // Increment the counter on button click
                    i += 1;

                    // Trigger the hidden file input
                    document.getElementById("fileInput").click();
                });

                document.getElementById("fileInput").addEventListener("change", function (event) {
                    const file = event.target.files[0];

                    if (file) {
                        const strategiesMenu = document.getElementById("strategiesMenu");

                        // Extract the file name without the extension
                        const fileName = file.name.split(".").slice(0, -1).join(".");

                        // Create a new list item
                        const newItem = document.createElement("li");
                        const newLink = document.createElement("a");

                        // Set attributes and content for the new link
                        newLink.className = "dropdown-item";

                        // Dynamically set the href with the selected file name
                        newLink.href = `/filename/${encodeURIComponent(fileName)}`;

                        // Set the link text to the file name
                        newLink.textContent = fileName;

                        // Append the new link to the list item
                        newItem.appendChild(newLink);

                        // Insert the new list item above the "Add More Strategy" button
                        strategiesMenu.insertBefore(newItem, strategiesMenu.lastElementChild);
                    }
                });
            </script>


            <li class="nav-item">
                <a class="nav-link text-dark" href="{{ url_for('pair.stock_pairs') }}"><i class="bi bi-cash-coin me-2"></i> Pairs Trading</a>
            </li>

            <li class="nav-item">
                <a class="nav-link text-dark" href="#"><i class="bi bi-cash-coin me-2"></i> Risk Management</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-dark" href="#"><i class="bi bi-cash-coin me-2"></i> Account Settles</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-dark" href="#"><i class="bi bi-cash-coin me-2"></i> Order Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-dark" href="#"><i class="bi bi-cash-coin me-2"></i> Notifications</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-dark" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-left me-2"></i> Logout</a>
            </li>
<!--            <li class="nav-item mt-3">-->
<!--                <label class="form-check form-switch">-->
<!--                    <input class="form-check-input" type="checkbox" id="darkModeSwitch">-->
<!--                    <span class="form-check-label">Dark Mode</span>-->
<!--                </label>-->
<!--            </li>-->
        </ul>
    </nav>

    <main class="p-4 flex-grow-1 bg-light">
        <body>
            <h4>Stock Pair Analysis</h4>
            <form action="{{ url_for('pairanalyze.analyze_stock_pair') }}" method="POST" id="stockForm" class="d-flex flex-wrap gap-3 align-items-center">
                <!-- First Row -->
                <div class="d-flex gap-3 flex-wrap">
                    <div>
                        <label for="stock1">Stock1:</label>
                        <input type="text" id="stock1" name="stock1" required>
                    </div>
                    <div>
                        <label for="stock2">Stock2:</label>
                        <input type="text" id="stock2" name="stock2" required>
                    </div>
                    <div>
                        <label for="period">Period:</label>
                        <select id="period" name="period" required>
                            <option value="1d">1 day</option>
                            <option value="5d">5 day</option>
                            <option value="1wk">1 week</option>
                            <option value="1mo">1 month</option>
                            <option value="3mo">3 month</option>
                            <option value="6mo">6 month</option>
                            <option value="1y">1 Year</option>
                            <option value="2y">2 year</option>
                            <option value="5y">5 year</option>
                            <option value="1ytd">till now</option>
                            <option value="max">Max</option>
                        </select>
                    </div>
                    <div>
                        <label for="interval">Interval:</label>
                        <select id="interval" name="interval" required>
                            <option value="1Min">1Min</option>
                            <option value="5Min">5Min</option>
                            <option value="15Min">15Min</option>
                            <option value="1Hour">1Hour</option>
                            <option value="1Day">1Day</option>
                        </select>
                    </div>
                </div>
                <!-- Second Row -->
<!--                <div class="d-flex gap-3 flex-wrap">-->
                    <div>
<!--                        <div class="align-self-end">-->
                            <button type="submit" name="analyze" class="btn btn-outline-primary ms-1">Analyze</button>
<!--                        </div>-->
                    </div>
<!--                </div>-->
            </form>
            <hr>
            <!-- Analysis Results -->
            <div class="row g-3 align-items-center">
                <div class="col-md-2"><p><strong>Analysis Results</strong></p></div>
                <div class="col-md-2">
                    <p>Correlation: <strong id="correlation">{{ result['correlation'] }}</strong></p>
                </div>
                <div class="col-md-2">
                    <p>P-Value: <strong id="pValue">{{ result['pValue'] }}</strong></p>
                </div>
            </div>
            <hr>

            <div class="text-center">
                {% if plot_data %}
                    <img src="data:image/png;base64,{{ plot_data }}" class="img-fluid" alt="Spread Chart">
                {% else %}
                    {% if e %}}
                        <p>e</p>
                        {% else %}
                            <p>No chart available.</p>
                    {% endif %}
                {% endif %}
            </div>

        </body>
    </main>


</div>

{% endblock %}
